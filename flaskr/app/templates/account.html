<!DOCTYPE html>
<html lang="en">
<head>
    <title>BioAuth - {{username}}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
</head>

<body >
    
    <!-- Background -->
    <div class="position-absolute vw-100 vh-100 start-0 top-0 z-1 flex items-center justify-center">
        <svg width="fill" height="fill" viewBox="0 0 1920 1080" fill="none" xmlns="http://www.w3.org/2000/svg" class="">
            <g filter="url(#filter0_f_41_37)">
                <ellipse cx="1227" cy="713.5" rx="447" ry="409.5" fill="#8A76FF" fill-opacity="0.47"></ellipse>
            </g>
            <g filter="url(#filter1_f_41_37)">
                <circle cx="1472" cy="382" r="325" fill="#76FFE4" fill-opacity="0.4"></circle>
            </g>
            <g filter="url(#filter2_f_41_37)">
                <circle cx="620" cy="769" r="325" fill="#C3E4FF" fill-opacity="0.7"></circle>
            </g>
            <g filter="url(#filter3_f_41_37)">
                <circle cx="455" cy="282" r="325" fill="#F7DCFF" fill-opacity="0.7"></circle>
            </g>
            <defs>
                <filter id="filter0_f_41_37" x="478.2" y="2.20001" width="1497.6" height="1422.6"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                    <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                    <feGaussianBlur stdDeviation="150.9" result="effect1_foregroundBlur_41_37"></feGaussianBlur>
                </filter>
                <filter id="filter1_f_41_37" x="845.2" y="-244.8" width="1253.6" height="1253.6"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                    <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                    <feGaussianBlur stdDeviation="150.9" result="effect1_foregroundBlur_41_37"></feGaussianBlur>
                </filter>
                <filter id="filter2_f_41_37" x="-6.79999" y="142.2" width="1253.6" height="1253.6"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                    <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                    <feGaussianBlur stdDeviation="150.9" result="effect1_foregroundBlur_41_37"></feGaussianBlur>
                </filter>
                <filter id="filter3_f_41_37" x="-171.8" y="-344.8" width="1253.6" height="1253.6"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                    <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend>
                    <feGaussianBlur stdDeviation="150.9" result="effect1_foregroundBlur_41_37"></feGaussianBlur>
                </filter>
            </defs>
        </svg>
    </div>

    <!-- BigWhiteBox -->
    <div  id="main-content" class="h-[40vw] w-[55%] pl-[7%] pr-[7%] rounded-[2vw] bg-white/70 z-10 grid grid-cols-1 content-center border-2 border-white ">

        <!-- BioAuthLogo -->
        <div class="grid grid-cols-9 content-center ">
            <img class="w-[3.5vw]  col-start-4 mt-[2vw] " src="../static/images/logoBioAuth.png" alt="logo" >
            <p class="col-start-5 text-[2.1vw] mt-[2vw] font-semibold">BioAuth</p>
        </div>

        <!-- UserCredentials -->
        <p class="text-[1.7vw] font-semibold col-start-1 pt-[2vw]">Account Details</p>

        <div class="grid grid-cols-4 content-center pt-[1vw] pb-[2vw] pr-[1.3vw]">
            <p class="text-[1.2vw] font-medium col-start-1"> Username </p>
            <p class="text-[1.2vw] font-medium col-start-2"> Email </p>

            <p class="text-[1vw] text-stone-500 col-start-1 pt-[1vw]"> {{ user_obj['username'] }} </p>
            <p class="text-[1vw] text-stone-700 col-start-2 pt-[1vw]"> {{ user_obj['email'] }} </p>
            
            <details id="popupToggle" class="open">
                <!-- Button to be visible -->
                <summary 
                    class="w-[12vw] h-[3vw] ms-[9vw] flex justify-center items-center rounded-full block px-[2vw] py-[1vw] text-[1vw] font-semibold bg-blue-500 hover:scale-105 hover:duration-300 hover:text-white cursor-pointer">
                    <p class="text-white"> Account Settings </p>
                   <!-- BUTTON -->
                </summary>
            </details> 

        </div>

        <!-- Timelog Table -->
        <div class="h-[25vh] overflow-y-auto rounded-[1vw] bg-white shadow-md">
            <table class="min-w-full table-fixed border-collapse rounded-[1vw]">
              <thead class="bg-white sticky top-0 z-10 shadow-sm">
                <tr class="text-gray-600 text-left text-[1.2vw]">
                  <th class="px-[1vw] py-[1vw] w-1/3">Event</th>
                  <th class="px-[1vw] py-[1vw] w-1/3">Timestamp</th>
                  <th class="px-[1vw] py-[1vw] w-1/3">Device</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100 bg-white text-sm text-gray-800">
                {% if logs %}
                  {% for log in logs %}
                    <tr class="hover:bg-gray-50">
                      <td class="px-[1vw] py-[0.8vw] text-[0.8vw]">{{ log.event }}</td>
                      <td class="px-[1vw] py-[0.8vw] text-[0.8vw]">{{ log.created_at }}</td>
                      <td class="px-[1vw] py-[0.8vw] text-[0.8vw]">{{ log.device }}</td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="3" class="px-[1vw] py-[1vw] text-center">No logs available</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
        </div>

        
        <!-- Logut Button -->
        <button 
            type="submit"
            class=" -left-[-0.3vw] -bottom-[-0.3vw] pl-4vw w-[10vw] h-[3vw] mt-[2vw] flex justify-center items-center rounded-full block  px-[2vw] py-[1.4vw] text-[1vw] font-semibold bg-[#0A0A0A] hover:duration-300 cursor-pointer text-white hover:text-white
            hover:scale-105"
            onclick="window.location.href='/logout'">
            <p>Log Out</p>
        </button>   
         

    </div>
    
    <!-- Content will be hidden until the user clicks on the account settings button. -->
    <div id="visiblePermanent" class="hidden grid grid-cols-9 bg-white rounded-[1vw] w-[50%] h-[40%] my-auto mx-auto absolute inset-0 text-gray-600 p-4 py-8 z-50">
                    
        <span onclick="document.querySelector('details').removeAttribute('open')" class="bg-gray-600 text-white text-[0.7vw] font-bold 
         flex items-center justify-center w-[1.6vw] h-[1.6vw] rounded-[1vw] absolute -right-[-0.3vw] -top-[-0.3vw] hover:bg-gray-800 duration-200 cursor-pointer"> 
         <svg xmlns="http://www.w3.org/2000/svg" width="0.8vw" fill="currentColor" class="inline flex justify-center items-center w-[0.6vw] height-[0.6vw] -right-[1vw] -top-[1vw]" viewBox="0 0 320.591 320.591">
            <path
              d="M30.391 318.583a30.37 30.37 0 0 1-21.56-7.288c-11.774-11.844-11.774-30.973 0-42.817L266.643 10.665c12.246-11.459 31.462-10.822 42.921 1.424 10.362 11.074 10.966 28.095 1.414 39.875L51.647 311.295a30.366 30.366 0 0 1-21.256 7.288z"
              data-original="#000000" />
            <path
              d="M287.9 318.583a30.37 30.37 0 0 1-21.257-8.806L8.83 51.963C-2.078 39.225-.595 20.055 12.143 9.146c11.369-9.736 28.136-9.736 39.504 0l259.331 257.813c12.243 11.462 12.876 30.679 1.414 42.922-.456.487-.927.958-1.414 1.414a30.368 30.368 0 0 1-23.078 7.288z"
              data-original="#000000" />
          </svg>
        </span>



        <p  class="row-start-1 col-start-3 col-span-5 text-[2.25vw] font-medium inline-block align-top flex justify-center items-center mb-8"> Account Settings </p>
        
        <p class="text-[1.5vw] font-medium row-start-2 px-[2vw]"> Username </p>
        <p class="text-[1.5vw] font-medium row-start-3 px-[2vw]"> Email </p>

        <!-- Form for Username -->
        <form method="POST" action="/update_username" id="UpdateUsernameForm" 
            class="h-[3vw] max-w-[30vw] w-full row-start-2 col-start-3 col-span-6 outline mb-[2vw] rounded-full p-[0.6vw]">
            <input class="w-full outline-none text-left text-sm pl-[0.5vw] my-[0.2vw]" 
                type="tel" 
                name="username" 
                placeholder="{{ user_obj['username'] }}"
                required readonly
            >
        </form>

        <!-- Form for Email -->
        <form method="POST" action="/update_email" id="UpdateEmailForm" 
            class="h-[3vw] max-w-[30vw] w-full row-start-3 col-start-3 col-span-6 outline mb-[2vw] rounded-full p-[0.6vw]">
            <input class="w-full outline-none text-left text-sm pl-[0.5vw] my-[0.2vw]"
                type="tel" 
                name="email" 
                placeholder="{{ user_obj['email'] }}"
                required readonly
            >
        </form>


        <!-- Update Username Buttons -->
        <div class="row-start-2 col-start-9 flex items-center mb-[2vw]">
            <button 
                type="button" 
                id="updateUsernameBtn" 
                class="bg-blue-500 text-white w-[3vw] h-[3vw] flex items-center justify-center rounded-full hover:scale-110 duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
                    stroke-linejoin="round" class="lucide lucide-pencil-icon w-[1vw] h-[1vw]">
                    <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
                    <path d="m15 5 4 4"/>
                </svg>
            </button>
            <button 
                type="submit" 
                form="UpdateUsernameForm" 
                id="saveUsernameBtn" 
                class="hidden bg-blue-500 text-white w-[3vw] h-[3vw] flex items-center justify-center rounded-full hover:scale-110 duration-200"
                disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-[1vw] h-[1vw]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
            </button>
        </div>

        <!-- Update Email Buttons -->
        <div class="row-start-3 col-start-9 flex items-center mb-[2vw]">
            <button 
                type="button" 
                id="updateEmailBtn"
                class="bg-blue-500 text-white w-[3vw] h-[3vw] flex items-center justify-center rounded-full hover:scale-110 duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
                    stroke-linejoin="round" class="lucide lucide-pencil-icon w-[1vw] h-[1vw]">
                    <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
                    <path d="m15 5 4 4"/>
                </svg>
            </button>
            <button 
                type="submit" 
                form="UpdateEmailForm" 
                id="saveEmailBtn" 
                class="hidden bg-blue-500 text-white w-[3vw] h-[3vw] flex items-center justify-center rounded-full hover:scale-110 duration-200"
                disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-[1vw] h-[1vw]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                </svg>
            </button>
        </div>

        <!-- Deletebutton -->
        <div class="row-start-4 col-start-1 col-end-10 flex justify-end pr-[2.2vw]">
            <button 
                onclick="confirmDelete()" 
                class="w-[12vw] h-[3vw] flex justify-center items-center rounded-full block font-semibold px-[2vw] py-[1.4vw] text-[1vw] bg-rose-500 hover:scale-105 hover:duration-300 hover:text-white cursor-pointer text-white">
                Delete Account
            </button>
        </div>

        <script>
            function confirmDelete() {
                if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                    window.location.href = '/delete-user';
                }
            }
        </script>
    </div>

    <script>
        const popupToggle = document.getElementById('popupToggle');
        const popup = document.getElementById('visiblePermanent');
        const main = document.getElementById('main-content');

        popupToggle.addEventListener('toggle', () => {
        if (popupToggle.open) {
            popup.classList.remove('hidden');
            main.classList.add('blur-[2px]');
        } else {
            popup.classList.add('hidden');
        main.classList.remove('blur-[2px]');
        }
        });
    </script>
    
    <script>
        let usernameInput = document.querySelector('#UpdateUsernameForm input[name="username"]');
        let emailInput = document.querySelector('#UpdateEmailForm input[name="email"]');
        
        let updateUsernameBtn = document.getElementById('updateUsernameBtn');
        let updateEmailBtn = document.getElementById('updateEmailBtn');
        let saveUsernameBtn = document.getElementById('saveUsernameBtn');
        let saveEmailBtn = document.getElementById('saveEmailBtn');
    
        // Track original values
        const originalUsername = usernameInput.placeholder;
        const originalEmail = emailInput.placeholder;
    
        // Style the Save buttons initially as disabled
        saveUsernameBtn.classList.add('opacity-50', 'cursor-not-allowed');
        saveEmailBtn.classList.add('opacity-50', 'cursor-not-allowed');
    
        updateUsernameBtn.addEventListener('click', () => {
            usernameInput.removeAttribute('readonly');
            usernameInput.focus();
            updateUsernameBtn.classList.add('hidden');
            saveUsernameBtn.classList.remove('hidden');
            saveUsernameBtn.disabled = true;
        });
    
        updateEmailBtn.addEventListener('click', () => {
            emailInput.removeAttribute('readonly');
            emailInput.focus();
            updateEmailBtn.classList.add('hidden');
            saveEmailBtn.classList.remove('hidden');
            saveEmailBtn.disabled = true;
        });
    
        usernameInput.addEventListener('input', () => {
            const changed = usernameInput.value.trim() !== '' && usernameInput.value !== originalUsername;
            saveUsernameBtn.classList.toggle('opacity-50', !changed);
            saveUsernameBtn.classList.toggle('cursor-not-allowed', !changed);
            saveUsernameBtn.classList.toggle('bg-blue-500', changed);
            saveUsernameBtn.classList.toggle('bg-gray-400', !changed);
            saveUsernameBtn.disabled = !changed;
        });
    
        emailInput.addEventListener('input', () => {
            const changed = emailInput.value.trim() !== '' && emailInput.value !== originalEmail;
            saveEmailBtn.classList.toggle('opacity-50', !changed);
            saveEmailBtn.classList.toggle('cursor-not-allowed', !changed);
            saveEmailBtn.classList.toggle('bg-blue-500', changed);
            saveEmailBtn.classList.toggle('bg-gray-400', !changed);
            saveEmailBtn.disabled = !changed;
        });
    </script>
    

</body>

</html>